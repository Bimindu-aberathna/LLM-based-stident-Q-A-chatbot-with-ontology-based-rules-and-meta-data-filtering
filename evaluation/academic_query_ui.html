<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Query System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1000px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .content {
            padding: 30px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group-full {
            grid-column: 1 / -1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
            font-family: inherit;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .response {
            display: none;
            margin-top: 25px;
            padding: 25px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }

        .response.active {
            display: block;
            animation: slideIn 0.4s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .response h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .response-item {
            margin-bottom: 12px;
            display: flex;
            gap: 10px;
        }

        .response-label {
            font-weight: 600;
            color: #555;
            min-width: 80px;
            display: flex;
            flex-direction: row;
            gap: 10px;
        }

        .response-value {
            color: #333;
            flex: 1;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-complete {
            background: #d4edda;
            color: #155724;
        }

        .error {
            display: none;
            padding: 15px;
            background: #f8d7da;
            color: #721c24;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #dc3545;
        }

        .error.active {
            display: block;
        }

        .section-title {
            font-size: 16px;
            color: #667eea;
            font-weight: 700;
            margin: 25px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
        }

        .switch input { 
        opacity: 0;
        width: 0;
        height: 0;
        }

        .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        -webkit-transition: .4s;
        transition: .4s;
        }

        .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        -webkit-transition: .4s;
        transition: .4s;
        }

        input:checked + .slider {
        background-color: #2196F3;
        }

        input:focus + .slider {
        box-shadow: 0 0 1px #2196F3;
        }

        input:checked + .slider:before {
        -webkit-transform: translateX(26px);
        -ms-transform: translateX(26px);
        transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
        border-radius: 34px;
        }

        .slider.round:before {
        border-radius: 50%;
        }
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            border-radius: 25px;
            background-color: #1ba83c;
            padding: 5px 15px;
            display: none;
        }
        .toast {
            color: white;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <script>
        const student_1 = {
            batch: "2020/21",
            department: "Industrial Management",
            faculty: "Science",
            degree_program: "Bsc(Hons) Information Technology",
            current_year: "4",
            current_sem: "2",
            specialization: "",
            course_codes: [
                "ACLT 11013", "CMSK 14042", "DELT 11232", "GNCT 11212", "GNCT 12212", 
                "INTE 11213", "INTE 12223", "INTE 12213", "INTE 12223", "INTE 12232", 
                "MGTE 11202", "MGTE 11213", "MGTE 11222", "MGTE 12222", "MGTE 12232", 
                "MGTE 12253", "PMAT 11212", "PMAT 12212", "DELT 21222", "GNCT 21212", 
                "GNCT 22212", "INTE 21213", "INTE 21233", "INTE 21243", "INTE 21263", 
                "INTE 21273", "INTE 21292", "INTE 22212", "INTE 22242", "INTE 22283", 
                "INTE 22293", "INTE 22303", "INTE 22313", "MGTE 22242", "INTE 12522","GNCT 32216", "INTE 31213", "INTE 31233", "INTE 31243", "INTE 31273", "INTE 31283", "INTE 31356", "MGTE 31212", "MGTE 31222", "INTE 41292", "INTE 41302", "INTE 41323", "INTE 41333", "INTE 41352", "INTE 42252", "INTE 43216", "INTE 44343", "MGTE 41212", "MGTE 42292", "MGTE 44273"
            ],
            courses_done: [
                "ACADEMIC LITERACY I", "INTRODUCTION TO COMPUTER HARDWARE AND CONSUMER ELECTRONICS",
                "ENGLISH FOR PROFESSIONALS", "PERSONAL PROGRESS DEVELOPMENT I",
                "PROBLEM SOLVING AND CRITICAL THINKING", "FUNDAMENTALS OF COMPUTING",
                "PROGRAMMING CONCEPTS", "OBJECT ORIENTED PROGRAMMING",
                "DATABASE DESIGN AND DEVELOPMENT", "COMPUTER NETWORK I",
                "ECONOMICS", "STATISTICS", "PRINCIPLES OF MANAGEMENT",
                "OPTIMIZATION METHODS IN MANAGEMENT SCIENCE I", "INDUSTRY AND TECHNOLOGY",
                "ACCOUNTING CONCEPTS AND COSTING", "MATHEMATICS FOR COMPUTING I",
                "MATHEMATICS FOR COMPUTING II", "COMMUNICATION SKILLS FOR PROFESSIONALS",
                "PERSONAL PROGRESS DEVELOPMENT II", "TECHNICAL WRITING",
                "INFORMATION SYSTEMS MODELLING", "WEB APPLICATION DEVELOPMENT I",
                "COMPUTER ARCHITECTURE AND OPERATING SYSTEMS", "DATA STRUCTURES AND ALGORITHMS",
                "DATA SCIENCE", "INFORMATION SECURITY I", "SOFTWARE DESIGN PATTERNS AND FRAMEWORKS",
                "WEB APPLICATIONS DEVELOPMENT II", "MOBILE APPLICATIONS DEVELOPMENT",
                "SOFTWARE ARCHITECTURE AND PROCESS MODELS", "ARTIFICIAL INTELLIGENCE",
                "INTERACTIVE APPLICATIONS DEVELOPMENT", "STATISTICAL DATA MODELLING",
"INTERNSHIP", "ADVANCED DATABASES", "HUMAN COMPUTER INTERACTION", "SOFTWARE QUALITY ENGINEERING", "SYSTEM INTEGRATION TECHNOLOGIES - 1", "BIG DATA AND DATA WAREHOUSING", "SOFTWARE DEVELOPMENT PROJECT", "PROJECT MANAGEMENT", "RESEARCH METHODS", "MOBILE COMPUTING", "GEOGRAPHICAL INFORMATION SYSTEMS", "NEURAL NETWORKS AND DEEP LEARNING", "DATA MINING AND APPLIED ANALYTICS", "SYSTEM INTEGRATION TECHNOLOGIES - 2", "SEMANTIC WEB AND ONTOLOGICAL ENGINEERING", "RESEARCH PROJECT", "", "PROFESSIONAL PRACTICES", "BUSINESS AND INFORMATION TECHNOLOGY LAW", "INNOVATION & ENTREPRENEURSHIP"
            ]
        };

        const student_2 = {
            batch: "2019/20",
            department: "DSE",
            faculty: "Computing and Technology",
            degree_program: "Bsc(Hons) Information & Communication Technology",
            current_year: "4",
            current_sem: "2",
            specialization: "",
            course_codes: ["CTEC11052", "CTEC11063", "GTEC11013", "GTEC11023", "GTEC11041", 
 "CTEC12052", "CTEC12073", "DELT13522", "GTEC12013", "GTEC12023", 
 "GTEC12033", "GTEC12033", "GTEC12062", "GTEC13032", "CTEC21042", 
 "CTEC21052", "CTEC21063", "DELT21512", "GTEC21023", "GTEC21023", 
 "GTEC21023", "GTEC21043", "LNPR21072", "CTEC22023", "CTEC22023", 
 "CTEC22032", "CTEC22043", "CTEC22053", "CTEC22061", "DELT22552", 
 "GTEC22033", "GTEC23032", "LNPR22072", "CTEC31013", "CTEC31013", 
 "CTEC31023", "CTEC31032", "CTEC31042", "ENPR31042", "SWST31022", 
 "SWST31032", "SWST31032", "CTEC32012", "GTEC32012", "SWST32012", 
 "SWST32022", "SWST32033", "SWST32043"]

,
            courses_done: ["STRUCTURED PROGRAMMING I","COMPUTER SYSTEMS ORGANIZATION","MATHEMATICS FOR TECHNOLOGY I","PHYSICS FOR TECHNOLOGY - I","ENGINEERING DRAWING WITH CAD I","DATA COMMUNICATION AND NETWORKING","STRUCTURED PROGRAMMING II","ENGLISH FOR COMPUTING AND TECHNOLOGY","MATHEMATICS FOR TECHNOLOGY II","PHYSICS FOR TECHNOLOGY II","FUNDAMENTALS PRACTICES IN TECHNOLOGY","FUNDAMENTALS PRACTICES IN TECHNOLOGY","STATISTICS FOR TECHNOLOGY","PROJECTS IN TECHNOLOGY I","WEB PROGRAMMING I","INTRODUCTION TO CYBER SECURITY","DATABASE SYSTEMS","ENGLISH FOR THE WORLD","FUNDAMENTALS OF ELECTRONICS","FUNDAMENTALS OF ELECTRONICS","FUNDAMENTALS OF ELECTRONICS","MATHEMATICS FOR TECHNOLOGY - III","JAPANESE LANGUAGE - I","DATA STRUCTURES & ALGORITHMS","DATA STRUCTURES & ALGORITHMS","SOFTWARE ENGINEERING","OBJECT ORIENTED PROGRAMMING","COMPUTER ARCHITECTURE & OPERATING SYSTEMS","SYSTEMS AND NETWORK LABORATORY","ENGLISH FOR TECHNOLOGY","MATHEMATICS FOR TECHNOLOGY - IV","PROJECTS IN TECHNOLOGY - II","JAPANESE LANGUAGE II","WEB PROGRAMMING II","WEB PROGRAMMING II","MOBILE APPLICATION DEVELOPMENT","ICT FOR BUSINESS","PYTHON PROGRAMMING","PRINCIPLES AND PRACTICES OF MANAGEMENT AND TECHNOLOGY MANAGEMENT","REQUIREMENTS ENGINEERING","APPLIED INFORMATION SYSTEMS","APPLIED INFORMATION SYSTEMS","HUMAN COMPUTER INTERACTION","PROJECT MANAGEMENT","SYSTEMS ANALYSIS AND DESIGN","QUALITY ASSURANCE","ADVANCED DATABASES","SOFTWARE ARCHITECTURE AND CONCEPTS"]

        };
        const student_3 = {
            batch: "2022/23",
            department: "Medicine",
            faculty: "Medicine",
            degree_program: "MBBS",
            current_year: "2",
            current_sem: "2",
            specialization: "",
            course_codes: ["BASS2204","BASS2203","BASS2203R","BASS2206","CHS2204","CHS2201","CHS2201N","PDFM2204","FAM2202","CSS2204","INTG2208"]
,
            courses_done: ["Blood, Lymph and Immune System (BASS)","Endocrine System (BASS)","Reproductive System (BASS)","Alimentary System & Nutrition (BASS)","Basic Epidemiology, Biostatistics & Research Methods (CHS)","Primary Health Care (CHS)","Nutrition (integrated, CHS)","Professional Development (PDFM, Phase II)","Family Medicine module & clinical attachment (FAM)","Clinical Skills â€” Simulation & Basics (CSS)","Integrated practicals / lab classes & assessments (year-2 integration)"]

        };
    </script>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ“ Academic Query System</h1>
            <p>Ask questions about your academic schedule and information</p>
        </div>

        <div class="content">
            <form id="queryForm">
                <div class="section-title">Student Preset</div>

                <div class="form-group">
                    <label for="student_preset">Select Student Preset</label>
                    <select id="student_preset">
                        <option value="">-- Select a preset --</option>
                        <option value="student_1">Industrial Management- 4th year</option>
                        <option value="student_2">Student 2 - ICT 4th year</option>
                        <option value="student_3">Medicine 2nd year</option>
                    </select>
                </div>

                <script>
                    document.getElementById('student_preset').addEventListener('change', function() {
                        const preset = this.value;
                        let studentData = null;

                        if (preset === 'student_1') {
                            studentData = student_1;
                        } else if (preset === 'student_2') {
                            studentData = student_2;
                        } else if (preset === 'student_3') {
                            studentData = student_3;
                        }

                        if (studentData) {
                            document.getElementById('batch').value = studentData.batch;
                            document.getElementById('department').value = studentData.department;
                            document.getElementById('faculty').value = studentData.faculty;
                            document.getElementById('degree_program').value = studentData.degree_program;
                            document.getElementById('current_year').value = studentData.current_year;
                            document.getElementById('current_sem').value = studentData.current_sem;
                            document.getElementById('specialization').value = studentData.specialization;
                            document.getElementById('course_codes').value = studentData.course_codes.join(', ');
                            document.getElementById('courses_done').value = studentData.courses_done.join(', ');
                        }
                    });
                </script>

                
                <div class="section-title">Student Information</div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="batch">Batch</label>
                        <input type="text" id="batch" value="2020/21">
                    </div>

                    <div class="form-group">
                        <label for="department">Department</label>
                        <input type="text" id="department" value="IM">
                    </div>

                    <div class="form-group">
                        <label for="faculty">Faculty</label>
                        <input type="text" id="faculty" value="Science">
                    </div>

                    <div class="form-group">
                        <label for="degree_program">Degree Program</label>
                        <input type="text" id="degree_program" value="Bsc(Hons) IT">
                    </div>

                    <div class="form-group">
                        <label for="current_year">Current Year</label>
                        <input type="text" id="current_year" value="3">
                    </div>

                    <div class="form-group">
                        <label for="current_sem">Current Semester</label>
                        <input type="text" id="current_sem" value="2">
                    </div>

                    <div class="form-group form-group-full">
                        <label for="specialization">Specialization</label>
                        <input type="text" id="specialization" value="">
                    </div>
                </div>

                <div class="section-title">Course Information</div>

                <div class="form-group">
                    <label for="course_codes">Course Codes (comma separated)</label>
                    <textarea id="course_codes">ACLT 11013, CMSK 14042, DELT 11232, GNCT 11212, GNCT 12212, INTE 11213, INTE 12223, INTE 12213, INTE 12223, INTE 12232, MGTE 11202, MGTE 11213, MGTE 11222, MGTE 12222, MGTE 12232, MGTE 12253, PMAT 11212, PMAT 12212, DELT 21222, GNCT 21212, GNCT 22212, INTE 21213, INTE 21233, INTE 21243, INTE 21263, INTE 21273, INTE 21292, INTE 22212, INTE 22242, INTE 22283, INTE 22293, INTE 22303, INTE 22313, MGTE 22242, INTE 12522</textarea>
                </div>

                <div class="form-group">
                    <label for="courses_done">Courses Done (comma separated)</label>
                    <textarea id="courses_done">ACADEMIC LITERACY I, INTRODUCTION TO COMPUTER HARDWARE AND CONSUMER ELECTRONICS, ENGLISH FOR PROFESSIONALS, PERSONAL PROGRESS DEVELOPMENT I, PROBLEM SOLVING AND CRITICAL THINKING, FUNDAMENTALS OF COMPUTING, PROGRAMMING CONCEPTS, OBJECT ORIENTED PROGRAMMING, DATABASE DESIGN AND DEVELOPMENT, COMPUTER NETWORK I, ECONOMICS, STATISTICS, PRINCIPLES OF MANAGEMENT, OPTIMIZATION METHODS IN MANAGEMENT SCIENCE I, INDUSTRY AND TECHNOLOGY, ACCOUNTING CONCEPTS AND COSTING, MATHEMATICS FOR COMPUTING I, MATHEMATICS FOR COMPUTING II, COMMUNICATION SKILLS FOR PROFESSIONALS, PERSONAL PROGRESS DEVELOPMENT II, TECHNICAL WRITING, INFORMATION SYSTEMS MODELLING, WEB APPLICATION DEVELOPMENT I, COMPUTER ARCHITECTURE AND OPERATING SYSTEMS, DATA STRUCTURES AND ALGORITHMS, DATA SCIENCE, INFORMATION SECURITY I, SOFTWARE DESIGN PATTERNS AND FRAMEWORKS, WEB APPLICATIONS DEVELOPMENT II, MOBILE APPLICATIONS DEVELOPMENT, SOFTWARE ARCHITECTURE AND PROCESS MODELS, ARTIFICIAL INTELLIGENCE, INTERACTIVE APPLICATIONS DEVELOPMENT, STATISTICAL DATA MODELLING</textarea>
                </div>

                <div class="section-title">Your Question</div>

                <div class="form-group">
                    <label for="q_id">Q_ID</label>
                    <input type="text" id="q_id" placeholder="e.g., Q001-1" value="Q001-1">
                </div>

                <div class="form-group">
                    <label for="message">Message</label>
                    <textarea id="message" placeholder="e.g., Is october 10th a holiday or not for the Industrial management department?">Is october 10th a holiday or not for the Industrial management department</textarea>
                </div>

                <div style="display: flex; justify-content: end; align-items: center; gap: 10px;">
                    <h4 style="padding-bottom: 5px;">Baseline Mode</h4>
                    <label class="switch">
                    <input type="checkbox">
                    <span class="slider round"></span>
                    </label>
                    <h4 style="padding-bottom: 5px;">Enhanced Mode</h4>
                </div>

                <button type="submit" class="btn" id="submitBtn">
                    Send Query
                </button>
            </form>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Processing your query...</p>
            </div>
            <div class="toast-container">
                    <div class="toast" id="toast">
                        Copied to clipboard!
                    </div>
                </div>

            <div class="error" id="error"></div>

            <div class="response" id="response">
                <h3>ðŸ“‹ Response</h3>
                <div class="response-item">
                    <span class="response-label">Model:</span>
                    <span class="response-value" id="responseModel">-</span>
                </div>
                
                <div class="response-item">
                    <span class="response-label">Question:</span>
                    <span class="response-value" id="responseQuestion">-</span>
                </div>
                <div class="response-item">
                    <span class="response-label">Status:</span>
                    <span class="response-value" id="responseStatus">-</span>
                </div>
                <div class="response-item" style="display: block;">
                    <span class="response-label">
                        <p>Answer:</p>
                        <input type="button" value="Copy" onclick="copyAnswer()" style="padding: 5px 10px; font-size: 12px; cursor: pointer; margin-left: 10px;">
                    </span>
                    <div class="response-value" id="responseAnswer" style="margin-top: 10px; padding: 15px; background: white; border-radius: 10px; line-height: 1.6;">-</div>
                </div>
                <div class="response-item" style="display: block;">
                    <span class="response-label">
                        <p>File names:</p>
                        <input type="button" value="Copy" onclick="copyFileNames()" style="padding: 5px 10px; font-size: 12px; cursor: pointer; margin-left: 10px;">
                    </span>
                    <div class="response-value" id="responseFileNames" style="margin-top: 10px; padding: 15px; background: white; border-radius: 10px; line-height: 1.6;">-</div>
                </div>
                <div class="response-item" style="display: block;">
                    <span class="response-label">
                        <p>Retrieved chunks:</p>
                        <input type="button" value="Copy" onclick="copyChunks()" style="padding: 5px 10px; font-size: 12px; cursor: pointer; margin-left: 10px;">
                    </span>
                    <div class="response-value" id="responseChunks" style="margin-top: 10px; padding: 15px; background: white; border-radius: 10px; line-height: 1.6;">-</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function copyAnswer() {
            const answerText = document.getElementById('responseAnswer').textContent;
            navigator.clipboard.writeText(answerText).then(() => {
                showToast('Answer copied to clipboard!');
            });
        }


        function copyFileNames() {
            const fileNamesText = document.getElementById('responseFileNames').textContent;
            navigator.clipboard.writeText(fileNamesText).then(() => {
                showToast('File names copied to clipboard!');
            });
        }

        function copyChunks() {
            const chunksText = document.getElementById('responseChunks').textContent;
            navigator.clipboard.writeText(chunksText).then(() => {
                showToast('Retrieved chunks copied to clipboard!');
            });
        }
        function showToast(message) {
            const toastContainer = document.querySelector('.toast-container');
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toastContainer.style.display = 'block';
        
            setTimeout(() => {
                toastContainer.style.display = 'none';
            }, 1500);
        }
    </script>
    <script>
        const form = document.getElementById('queryForm');
        const submitBtn = document.getElementById('submitBtn');
        const loading = document.getElementById('loading');
        const responseDiv = document.getElementById('response');
        const errorDiv = document.getElementById('error');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            responseDiv.classList.remove('active');
            errorDiv.classList.remove('active');
            loading.classList.add('active');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Sending...';

            const courseCodesText = document.getElementById('course_codes').value;
            const coursesDoneText = document.getElementById('courses_done').value;

            const courseCodes = courseCodesText
                .split(',')
                .map(code => code.trim())
                .filter(code => code.length > 0);

            const coursesDone = coursesDoneText
                .split(',')
                .map(course => course.trim())
                .filter(course => course.length > 0);

            const requestData = {
                batch: document.getElementById('batch').value,
                department: document.getElementById('department').value,
                degree_program: document.getElementById('degree_program').value,
                faculty: document.getElementById('faculty').value,
                current_year: document.getElementById('current_year').value,
                current_sem: document.getElementById('current_sem').value,
                specialization: document.getElementById('specialization').value,
                course_codes: courseCodes,
                courses_done: coursesDone,
                Q_id: document.getElementById('q_id').value,
                message: document.getElementById('message').value
            };

            try {
                const mode = form.querySelector('input[type="checkbox"]').checked ? 'enhanced' : 'baseline';
                requestData.mode = mode;
                // if baseline mode = endpoint is /chat/baselineQuery
                // if enhanced mode = endpoint is /chat/query
                const endpoint = mode === 'enhanced' ? 'query' : 'baselineQuery';
                const response = await fetch(`http://localhost:8000/chat/${endpoint}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                document.getElementById('responseModel').textContent = data.model || '-';
                document.getElementById('responseQuestion').textContent = data.question || '-';
                document.getElementById('responseAnswer').textContent = data.answer || '-';

                // Fix for source_lst - ensure it displays properly
                const fileNamesElement = document.getElementById('responseFileNames');
                fileNamesElement.textContent = data.source_lst || 'N/A';
                fileNamesElement.style.maxHeight = '200px';
                fileNamesElement.style.overflowY = 'auto';
                fileNamesElement.style.whiteSpace = 'pre-wrap';

                // Fix for documents - ensure it displays properly
                const chunksElement = document.getElementById('responseChunks');
                chunksElement.textContent = data.documents || 'N/A';
                chunksElement.style.maxHeight = '300px';
                chunksElement.style.overflowY = 'auto';
                chunksElement.style.whiteSpace = 'pre-wrap';
                chunksElement.style.wordBreak = 'break-word';
                
                const statusSpan = document.getElementById('responseStatus');
                statusSpan.innerHTML = `<span class="status-badge status-${data.status}">${data.status || 'unknown'}</span>`;
                
                responseDiv.classList.add('active');

            } catch (error) {
                errorDiv.textContent = `Error: ${error.message}. Please make sure the server is running on http://localhost:8000`;
                errorDiv.classList.add('active');
            } finally {
                loading.classList.remove('active');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Send Query';
            }
        });
    </script>
</body>
</html>